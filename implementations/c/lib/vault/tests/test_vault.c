/**
********************************************************************************************************
* @file   test_vault.c
* @brief
********************************************************************************************************
*/

/*
 ********************************************************************************************************
 *                                             INCLUDE FILES                                            *
 ********************************************************************************************************
 */

#include <stdio.h>

#include "default.h"
#include "ockam/error.h"
#include "ockam/memory.h"
#include "ockam/vault.h"

/*
 ********************************************************************************************************
 *                                                DEFINES                                               *
 ********************************************************************************************************
 */

#define TEST_VAULT_RAND_SIZE                      32u

/*
 ********************************************************************************************************
 *                                               CONSTANTS                                              *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                               DATA TYPES                                             *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                          FUNCTION PROTOTYPES                                         *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                            GLOBAL VARIABLES                                          *
 ********************************************************************************************************
 */

const OckamMemory *memory = &ockam_memory_stdlib;

OckamVaultDefaultConfig default_cfg = {.features = OCKAM_VAULT_ALL, .ec = kOckamVaultEcCurve25519};

uint8_t g_rand_num[TEST_VAULT_RAND_SIZE] = {0};

/*
 ********************************************************************************************************
 *                                           GLOBAL FUNCTIONS                                           *
 ********************************************************************************************************
 */

/*
 ********************************************************************************************************
 *                                            LOCAL FUNCTIONS                                           *
 ********************************************************************************************************
 */

/**
 ********************************************************************************************************
 *                                             main()
 *
 * @brief   Main point of entry for mbedcrypto test
 *
 ********************************************************************************************************
 */

int main(void) {
  OckamError err;
  void *default_ctx = 0;

  memory->Create(0);

  /* ---------- */
  /* Vault Init */
  /* ---------- */

  err = OckamVaultDefaultCreate(&default_ctx,
                                &default_cfg,
                                memory);
  if (err != kOckamErrorNone) {
    return -1;
  }

  err = OckamVaultRandom(default_ctx,
                         &g_rand_num[0],
                         TEST_VAULT_RAND_SIZE);


  {
    int i = 0;
    uint8_t *p_rand = &g_rand_num[0];

    printf("Random Number: \r\n");

    for(i = 1; i <= TEST_VAULT_RAND_SIZE; i++) {
      printf("0x%02x, ", *p_rand++);
      if(i % 8 == 0) {
        printf("\n");
      }
    }
  }

  return 0;
}

